<!DOCTYPE html>
<html>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        circle {
            stroke: black;
            opacity: 0.2;
        }

        .annotation {
            opacity: 1;
            position: absolute;
            width: 120px;
            height: 140px;
            text-align: center;
            background-color: white;
            border: 3px solid green;
            border-radius: 10px;
            padding: 2px;
        }
    </style>
<body onload='init()'>
<div class="page-header">
    <h1>CS416 Project 2 - Week 9: <small>Narrative Visualization</small></h1>
</div>

<div class="row scatter">
    <div id="div_template" class="col-sm-9">
    </div>
    <div class="col-sm-3">
        <h3>Navigation:</h3>
        <div class="btn-toolbar" role="toolbar" aria-label="...">
            <div class="btn-group" role="group" aria-label="...">
                <p>
                    <div id="button1" class="btn btn-primary" onclick="changeScene(1)">1</div>
                    <div id="button2" class="btn btn-default" onclick="changeScene(2)">2</div>
                    <div id="button3" class="btn btn-default" onclick="changeScene(3)">3</div>
                    <div id="button4" class="btn btn-default" onclick="changeScene(4)">4</div>
                </p>
            </div>
        </div>
        <div id="scene-desc" class="">
            <p>Looking at the chart, we can see a clear relationship between life expectancy and GDP per Capita.
                People tend to have a lower life expectancy in poor countries, and on the contrary, the people that
                live in wealthy countries tend to have a higher life expectancy.</p>
        </div>
        <h3>Year 2018</h3>
        <div id="legend-group" class="col-sm-3">
            <div class="legendTitle" style="font-size: 12px;">REGION</div>
            <div id="legend"></div>
        </div>
    </div>
</div>

<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
<script>
    var margin = {left: 50, top: 20, right: 20, bottom: 20},
        width = 800 - margin.left - margin.right,
        height = width * 2 / 3;

    var globalSceneNumber = 1;
    var globalGraphNumber = 1;
    var showToolTip = false;
    var showAnnotation1 = true;
    var showAnnotation2 = false;
    var showAnnotation3 = false;
    var showYearSelection = false;
    var regionSelect = "";
    var showLegendSelection = false;
    var highlightOpacity = 0.8;
    var normalOpacity = 0.4;

    function resetScene(sceneNumber) {
        d3.select("#div_template").html("");
        d3.select("#legend").html("");
        d3.selectAll(".btn").attr("class", "btn btn-default");
        d3.select("#button" + sceneNumber).attr("class", "btn btn-primary");
        init();
    }

    function changeScene(sceneNumber) {
        globalSceneNumber = sceneNumber;
        if (globalSceneNumber === 1) {
            showToolTip = false;
            showAnnotation1 = true;
            showAnnotation2 = false;
            showAnnotation3 = false;
            showYearSelection = false;
            createGraphs(1);
            regionSelect = "";
            showLegendSelection = false;
            d3.select("#scene-desc")
                .html("<p>Looking at the chart, we can see a clear relationship between life expectancy and GDP per Capita." +
                    "People tend to have a lower life expectancy in poor countries, and on the contrary, the people that live in wealthy countries tend to have a higher life expectancy.</p>");
            resetScene(1);
        }
        if (globalSceneNumber === 2) {
            showToolTip = false;
            showAnnotation1 = false;
            showAnnotation2 = true;
            showAnnotation3 = false;
            showYearSelection = false;
            createGraphs(1);
            regionSelect = "Europe";
            showLegendSelection = false;
            d3.select("#scene-desc")
                .html("<p>But there are still regional differences. For example, Europe is different. " +
                    "It seems all European countries tend to have very high life expectancy, though their GDP per Capita varies much.</p>");
            d3.select("#div_template").html("");
            resetScene(2);
        }
        if (globalSceneNumber === 3) {
            showToolTip = false;
            showAnnotation1 = false;
            showAnnotation2 = false;
            showAnnotation3 = true;
            showYearSelection = false;
            createGraphs(2);
            regionSelect = "";
            showLegendSelection = false;
            d3.select("#scene-desc")
                .html("<p>Looking at the chart, we can see a clear relationship between life expectancy and Health Expenditure per Capita." +
                    "People tend to have a lower life expectancy in countries with lower healthcare expenditure per capita compared to countries with higher rates.</p>");
            resetScene(3);
        }
        if (globalSceneNumber === 4) {
            showToolTip = true;
            showAnnotation1 = false;
            showAnnotation2 = false;
            showAnnotation3 = false;
            showYearSelection = true;
            regionSelect = "";
            showLegendSelection = true;
            d3.select("#scene-desc")
                .html("<h2>Explore with your mouse!</h2><br><p>" +
                    "Move your mouse over the legend and the circles.</p>");
            resetScene(4);
        }
    }

    async function init() {
        var Tooltip = d3.select("#div_template")
            .append("div")
            .style("opacity", 0)
            .style("position", "absolute")
            .attr("class", "tooltip")
            .style("width", "200px")
            .style("height", "100px")
            .style("text-align", "center")
            .style("background-color", "white")
            .style("border", "solid")
            .style("border-width", "2px")
            .style("border-radius", "2px")
            .style("padding", "2px");



        if (showAnnotation2) {
            var Annotation2 = d3.select("#div_template")
                .append("div")
                .attr("class", "annotation")
                .html("<em>European</em> countries have high life expectancy and GDP income")
                .style("left", "750px")
                .style("top", "250px");
        }

        if (showAnnotation3) {
            var Annotation3_1 = d3.select("#div_template")
                .append("div")
                .attr("class", "annotation")
                .html("The <em>lowest Healthcare Expenditure</em> countries have <em>lowest</em> life expectancy")
                .style("left", "100px")
                .style("top", "300px");

            var Annotation3_2 = d3.select("#div_template")
                .append("div")
                .attr("class", "annotation")
                .html("The <em>highest Healthcare Expenditure</em> countries have <em>highest</em> life expectancy")
                .style("left", "750px")
                .style("top", "200px");
        }


    // Initialize the first scene
    changeScene(1);
</script>
</body>
</html>
